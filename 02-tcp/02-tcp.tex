
%   COMP3310 TCP tutorial
%   Written by Hugh Fisher, ANU, 2024
%   Creative Commons CC-BY-4.0 license

%   LaTeX markup for XeTeX with a standard texlive distribution
%   Command to build:
%       xelatex 02-tcp.tex

\input{../common/formatting}

\begin{document}

\TITLE{TCP Client Server}


\MINOR{Outline}

In this tutorial you will

\DOT Study the differences between UDP and TCP program design

\DOT Study how data is transmitted and received over TCP

\DOT Try designing, and re-designing, a simple protocol


This tutorial is very similar to the previous UDP client-server, so you should
know what to do. Before studying anything in detail make sure everything is
working. Run the server in one window, the client in another. Whatever
you type in the client window will be sent to the server and echoed back. EOF
in the client window to stop, Control-C for the server.

For this tutorial you should have WireShark (or \texttt{tcpdump}) running
on the loopback interface, port 3310.


\SECTION{Program Design}

Open all the source code files (for your preferred language) in your editor
or IDE.

The TCP client and server both use a shared library for reading and writing
lines of text, \NAME{sockLine.py} or \NAME{SockLine.java}. Have a look at the
code.

Sending a line is easy: append a newline special character and then encode
into UTF-8. It is only a couple of lines, but using a library means we cannot
forget either step.

Reading a line is very different. The UDP programs received packets, and each
package was a single request or response. TCP hides the packets, so a TCP
socket behaves like a sequential file of bytes. The library code reads one
byte at a time, but this does not mean that every byte is a packet. WireShark
will show you what is actually being sent.

The TCP client uses the shared library, so the code for reading and writing
is shorter. One difference is that the client sends a final message on EOF:
this is a simple example of \NAME{protocol} design so the server can tell
whether a client deliberately ended the session or just crashed.

The TCP server code is structured very differently. A UDP server responds
to client packets and does not really need any state. A TCP server receives
connection requests from a client, and each connection is a \NAME{session}
dedicated to that client. The server now has two loops, one for client connections
and one for requests by a single client.


\SECTION{Data Over TCP}

In the UDP tutorial you could start a client with no server running. Try the
same with the TCP client.

Two UDP clients could run at the same time (in different terminal windows),
both sending requests to a single server. Try the same with the TCP server
and two clients. What happens?

\begin{IMPORTANT}
A real world server that only one person can use at a time would not be very
useful, but in this course we are studying computer networks, not Site
Reliability Engineering. Do \emph{not} use threads, timeouts, async\ldots
in your assignments without first asking if you really need to.
\end{IMPORTANT}

1. Modify the server \texttt{handleRequest} code so that it uses the special
\NAME{slowSend} in the socket line library instead of \texttt{writeLine}.
With a new server running, try sending requests of varying length from the
client. What does WireShark show? How many responses does the client receive?

Control-C the server and change the code back to using \texttt{writeLine}.
(If you don't, you will be waiting a very long time for the next step to
complete.)

2. The tutorial includes a text file \texttt{loremIpsum.txt} which is a
single 16K long line of randomly generated words. Use this as a client
request by running the client program with standard input from this file,
not the terminal.
\CODELINE{python tcpClient.py < loremIpsum.txt}
or
\CODELINE{java TcpClient  < loremIpsum.txt}


\SECTION{Optional}

The TCP server can echo the input from other programs, not just the client.
Open a web browser and type \texttt{localhost:3310} as the URL.
Or try \NAME{telnet} or \NAME{nc} as the client. 

Rewrite the server with a client session class, so that each \texttt{serverLoop}
could be run as a thread to handle multiple client connections in parallel.

\COPYRIGHT

\end{document}
